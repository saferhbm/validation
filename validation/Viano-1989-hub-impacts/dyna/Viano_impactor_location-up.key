*KEYWORD
*PARAMETER
$ HBM coordinate system (TODO: check orientation)
$ x-axis in forward direction
$ y-axis to the right
$ z-axis upwards
$ input: 1 for correct axis orientation and -1 to invert axis
$
$THUMS
$R x_rt    -1
$R y_rt    -1
$R z_rt    1
$VIVA+
R x_rt    1
R y_rt    1
R z_rt    1
$
$
$-------------------------------------------------------------------------------
$-Switches - Do not change! Can be also put into seperate include file
$-------------------------------------------------------------------------------
$ SEX Parameter (not needed for VIVA+ models 1=male 0=female)
R SEX      1
$-------------------------------------------------------------------------------
$ Velocities - Do not change!
$-------------------------------------------------------------------------------
$high severity pelvis
R Vel_H_HS 9.8
$ med severity pelvis (no experimential data!)
R Vel_H_MS 6.5
$ low severity pelvis
R Vel_H_LS 5.2
$ low severity thorax
R Vel_T_LS 4.4
$ med severity thorax
R Vel_T_MS 6.5
$ high severity thorax
R Vel_T_HS 9.5
$ low severity abdomen
R Vel_A_LS 4.8
$ med severity abdomen
R Vel_A_MS 6.8
$ high severity abdomen
R Vel_A_HS 9.4
$-------------------------------------------------------------------------------
$ Reference System of your HBM - Align to Center of Acetabuli 
$-------------------------------------------------------------------------------
$ Loaction of Center of Acetabuli or H-Point (TODO: measure in your HBM)
$ SAFER v10
R x_ACi   13.76
R y_ACi   0
R z_ACi   13.61
$ THUMS V4 O:
$R x_ACi   -93.1
$R y_ACi   72.1
$R z_ACi   -60.6
$-------------------------------------------------------------------------------
$ Mass of Impactor - Do not change!
$-------------------------------------------------------------------------------
$ Mass of impactor in the tests
R M_imp_te 23.4
$ Mass of impactor model
R M_imp_mo 23.4
$-------------------------------------------------------------------------------
$ Angle of Impactor - Do not change!
$-------------------------------------------------------------------------------
$ Angle for impacts at thorax and abdomen
R z_rot_AT -60.0
R y_rot_AT  0.0
$
$ Angle for impacts at hip
R z_rot_H  -90.0
R y_rot_H  0.0
$-------------------------------------------------------------------------------
$ Angle of Impactor - Align with Sternum angle!
$-------------------------------------------------------------------------------
$ Angle of sternum (TODO: measured angle between cnter of attachment of 4th to 
$ 2nd rib relative to yz plane)
$ in Occupant posture (for 23 deg reclined seat) - TODO!!!
$VIVA +
R y_r_ST_O 24.8 
$THUMSv4
$R y_r_ST_O  17.7 
$ in upright standing position for VIVA+ model where offset was measured (do not change)
R y_r_ST_S  10.9
$-------------------------------------------------------------------------------
$ Location of Impactor - Align with your HBM!
$-------------------------------------------------------------------------------
$ Z offset of impactor (relative to Origin)
$ 1. for hip impact (ignore for now)
$ Location of trochanter major for female (only needed for hip impact)
R x_HF    -14
R y_HF    -201
R z_HF    803
$ Location of trochanter major for male (only needed for hip impact)
R x_HM    -18.2
R y_HM    -201
R z_HM    899
$ 2. For thoraxic impact (aligned with PX)
$ Coordinate of PX 
$ Male (TODO: measure PX in your HBM!)
$
$ $ VIVA+
$ Rx_PX_Mi  -51
$ Ry_PX_Mi  0
$ Rz_PX_Mi  306.4
$ SAFER
Rx_PX_Mi  -50.3
Ry_PX_Mi  0.32
Rz_PX_Mi  284.8
$
$THUMS v4
$Rx_PX_Mi  -21.1
$Ry_PX_Mi  0ich 
$Rz_PX_Mi  197.2
$
$
$ Female 
R x_PX_F  0
R y_PX_F  0
R z_PX_F  0 
$ offset z of impactor to PX (Do not change!)
$ for 50M (based on VIVA+ models)
R x_TX_M  -8
R y_TX_M  -130
$ for 50F (based on VIVA+ models)
R x_TX_F  0
R y_TX_F  0
$ offset for abdominal impacts (from experiments)
R z_off_AB -75
$ Additional offset in moving direction (if needed)
$ for Male 
$ for Thorax Impact (TODO: Check if offset needed) 
R TM_off  70
$ for Abdomen Impact
R AM_off  0
$ for Hip Impact
R HM_off  0
$ for Female
$ for Thorax Impact
R TF_off  0
$ for Abdomen Impact
R AF_off  0
$ for Hip Impact
R HF_off  0
$-------------------------------------------------------------------------------
$ Parameter Expressions - Do not change!
$-------------------------------------------------------------------------------
$
$ HBM rotation
*PARAMETER_EXPRESSION
R x_PX_M  x_PX_Mi*x_rt
R y_PX_M  y_PX_Mi*y_rt
R z_PX_M  z_PX_Mi*z_rt
R x_AC    x_ACi*x_rt
R y_AC    y_ACi*y_rt
R z_AC    z_ACi*z_rt
R x_deg   (x_rt+1)*90  
R y_deg   (y_rt+1)*90
R z_deg   (z_rt+1)*90
$
$
$
*PARAMETER_EXPRESSION
RHBM_off_x -x_AC
RHBM_off_y -y_AC
RHBM_off_z -z_AC
*PARAMETER_EXPRESSION
R z_rot   z_rot_H*Impact_H+z_rot_AT*(Impact_A+Impact_H)
R z_AF    z_PX_F+z_off_AB
R z_AM    z_PX_M+z_off_AB
*PARAMETER_EXPRESSION
R SF_m_Imp M_imp_te/M_imp_mo
*PARAMETER_EXPRESSION
$ Select correct impact speed based on switches
R VEL_Imp -1*(Impact_H*((LS*Vel_H_LS)+(MS*Vel_H_MS)+(HS*Vel_H_HS))+
          Impact_A*((LS*Vel_A_LS)+(MS*Vel_A_MS)+(HS*Vel_A_HS))+
          Impact_T*((LS*Vel_T_LS)+(MS*Vel_T_MS)+(HS*Vel_T_HS)))
$y rotation of HBM to align sternum orientation
R y_rot   y_r_ST_S-y_r_ST_O
R x_off_HFHF_off*(cos(z_rot_H*(3.14159/180))*cos(y_rot*(3.14159/180)))
R y_off_HFHF_off*(cos(y_rot_H*(3.14159/180))*sin(z_rot*(3.14159/180)))
$R z_off_HFHF_off*(-sin(y_rot*(3.14159/180)))
R z_off_HF 0
R x_off_AFAF_off*(cos(z_rot_AT*(3.14159/180))*cos(y_rot*(3.14159/180)))
R y_off_AFAF_off*(cos(y_rot_AT*(3.14159/180))*sin(z_rot*(3.14159/180)))
$R z_off_AFAF_off*(-sin(y_rot*(3.14159/180)))
R z_off_AF 0
R x_off_TFTF_off*(cos(z_rot_AT*(3.14159/180))*cos(y_rot*(3.14159/180)))
R y_off_TFTF_off*(cos(y_rot_AT*(3.14159/180))*sin(z_rot*(3.14159/180)))
$R z_off_TFTF_off*(-sin(y_rot*(3.14159/180)))
R z_off_TF 0
R x_off_HMHM_off*(cos(z_rot_H*(3.14159/180))*cos(y_rot*(3.14159/180)))
R y_off_HMHM_off*(cos(y_rot_H*(3.14159/180))*sin(z_rot*(3.14159/180)))
$R z_off_HMHM_off*(-sin(y_rot*(3.14159/180)))
R z_off_HM 0
R x_off_AMAM_off*(cos(z_rot_AT*(3.14159/180))*cos(y_rot*(3.14159/180)))
R y_off_AMAM_off*(cos(y_rot_AT*(3.14159/180))*sin(z_rot*(3.14159/180)))
$R z_off_AMAM_off*(-sin(y_rot*(3.14159/180)))
R z_off_AM 0
R x_off_TMTM_off*(cos(z_rot_AT*(3.14159/180))*cos(y_rot*(3.14159/180)))
R y_off_TMTM_off*(cos(y_rot_AT*(3.14159/180))*sin(z_rot*(3.14159/180)))
$R z_off_TMTM_off*(-sin(y_rot*(3.14159/180)))
R z_off_TM 0
$
$-------------------------------------------------------------------------------
$ Transformation of HBM
$-------------------------------------------------------------------------------
*DEFINE_TRANSFORMATION_TITLE
Transformation of HBM
$   TRANID|
        10
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z
ROTATE             1         0         0&HBM_off_x&HBM_off_y&HBM_off_z    &x_deg
ROTATE             0         1         0&HBM_off_x&HBM_off_y&HBM_off_z    &y_deg
ROTATE             0         0         1&HBM_off_x&HBM_off_y&HBM_off_z    &z_deg
$-------------------------------------------------------------------------------
$ Transformation of Impactor - Do not change!
$-------------------------------------------------------------------------------
*DEFINE_TRANSFORMATION_TITLE
Transformation of Impactor Female - Hip
$   TRANID|
        21
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
ROTATE            0.        1.        0.        0.        0.        0.    &y_rot
ROTATE            0.        0.        1.        0.        0.        0   &z_rot_H
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z    
TRANSL    &x_HF     &y_HF     &z_HF
TRANSL    &x_off_HF &y_off_HF &z_off_HF
*DEFINE_TRANSFORMATION_TITLE
Transformation of Impactor Female -Abdomen
$   TRANID|
        22
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
ROTATE            0.        1.        0.        0.        0.        0.    &y_rot
ROTATE            0.        0.        1.        0.        0.        0  &z_rot_AT
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z
TRANSL    &x_PX_F      &y_PX_F     &z_AF  
TRANSL    &x_TX_F      &y_TX_F
TRANSL    &x_off_AF &y_off_AF &z_off_AF
*DEFINE_TRANSFORMATION_TITLE
Transformation of Impactor Female - Thorax
$   TRANID|
        23
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
ROTATE            0.        1.        0.        0.        0.        0.    &y_rot
ROTATE            0.        0.        1.        0.        0.        0  &z_rot_AT
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z
TRANSL    &x_PX_F      &y_PX_F   &z_PX_F
TRANSL    &x_TX_F      &y_TX_F  
TRANSL    &x_off_TF &y_off_TF &z_off_TF
*DEFINE_TRANSFORMATION_TITLE
Transformation of Impactor Male - Hip
$   TRANID|
        31
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
ROTATE            0.        1.        0.        0.        0.        0.    &y_rot
ROTATE            0.        0.        1.        0.        0.        0   &z_rot_H
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z
TRANSL    &x_HM     &y_HM     &z_HM
TRANSL    &x_off_HM &y_off_HM &z_off_HM
*DEFINE_TRANSFORMATION_TITLE
Transformation of Impactor Male -Abdomen
$   TRANID|
        32
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
ROTATE            0.        1.        0.        0.        0.        0.    &y_rot
ROTATE            0.        0.        1.        0.        0.        0  &z_rot_AT
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z
TRANSL    &x_PX_M      &y_PX_M     &z_AM 
TRANSL    &x_TX_M      &y_TX_M 
TRANSL    &x_off_AM &y_off_AM &z_off_AM
$
*PARAMETER_EXPRESSION
$relative distance TX to PX
$
*DEFINE_TRANSFORMATION_TITLE
Transformation of Impactor Male - Thorax
$   TRANID|
        33
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
ROTATE            0.        1.        0.        0.        0.        0.    &y_rot
ROTATE            0.        0.        1.        0.        0.        0  &z_rot_AT
$   OPTION|       A1|       A2|       A3|       A4|       A5|       A6|       A7|
TRANSL    &HBM_off_x&HBM_off_y&HBM_off_z
TRANSL    &x_PX_M      &y_PX_M   &z_PX_M
TRANSL    &x_TX_M      &y_TX_M
TRANSL    &x_off_TM &y_off_TM &z_off_TM
*END